<!DOCTYPE html>
<html>

<body onload='init()'>
    Name: <input type='text' id='command' value='/d'>

    <p>Click the button to change the value of the text field.</p>

    <button onclick='deckCommand()'>Try it</button>
    <script>
        var decks = [];
        var suits = ['cuori', 'quadri', 'fiori', 'picche'];
        var ranks = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 'J', 'Q', 'K'];

        var deckCommand = function() {

            var outPut = document.getElementById('command');
            var boxValue = outPut.value;
            // Our bot needs to know if it will execute a command
            // It will listen for messages that will start with `!`
            if (boxValue.substring(0, 2) == '/d') {
                var args = boxValue.substring(1).split(' ');
                if (args.length >= 2) {
                    var cmd = args[1];

                    switch (cmd) {
                        // !ping
                        case 'ping':
                            alert('pong');
                            break;
                        case 'draw':
                            if (args.length === 4) {
                                console.log('draw: ');
                                drawCard(args[2], args[3]);
                            } else {
                                console.log('Command wrong: declare what deck and how many cards es /d draw 4 52');
                            }
                            break;
                        case 'shaffle':
                            if (args.length === 3) {
                                shaffle(args[2]);
                                console.log('shaffled');
                            } else {
                                console.log('Command wrong: declare what deck to shaffle es /d shaffle 4');
                            }
                            break;
                        case 'reveal':
                            if (args.length === 4) {
                                console.log('reveal');
                                reveal(args[2], args[3]);
                            } else {
                                console.log('Command wrong: declare what deck and how many cards es /d reveal 4 52');
                            }
                            break;
                        case 'graveyard':
                            if (args.length === 3) {
                                console.log('graveyard');
                                graveyard(args[2]);
                            } else {
                                console.log('Command wrong: declare what graveyard and how many cards es /d graveyard 4 1');
                            }
                            break;
                        case 'top':
                            break;
                        case 'discard':
                            break;
                        case 'hand':
                            break;
                        case 'reset':
                            init();
                            console.log('reset all deck!');
                            break;
                            // Just add any case commands if you want to..
                    }
                }
            }

        }
        var reveal = function(deckNumber, cardsNumber) {
            //todo control parameter: if they are number and if they are <=8, <=52
            var toDraw = decks[deckNumber];

            if (toDraw.card.length > 0 && cardsNumber > 0) {
                for (var i = 0; i < cardsNumber; i++) {
                    if (toDraw.card.length - cardsNumber <= 0) {
                        cardsNumber = toDraw.card.length;
                    }
                    if (toDraw.card.length > 0) {
                        card = toDraw.card[(toDraw.card.length - i - 1)];
                        console.log(card.rank + ' ' + card.suit);
                    } else if (toDraw.card.length === 0) {
                        console.log('You drawed all the card, shaffle and draw ' + (cardsNumber - i) + ' cards ');
                        break;
                    } else {
                        console.log('ERROR 01');
                        break;
                    }
                }
            } else {
                console.log('You drawed all the card, shaffle and draw ' + (cardsNumber) + ' cards ');
            }
        }
        var drawCard = function(deckNumber, cardsNumber) {
            //todo control parameter: if they are number and if they are <=8, <=52
            var toDraw = decks[deckNumber];

            if (toDraw.card.length > 0 && cardsNumber > 0) {
                for (var i = 0; i < cardsNumber; i++) {
                    if (toDraw.card.length > 0) {
                        card = toDraw.card.splice((toDraw.card.length - 1), 1)[0];
                        toDraw.graveyard.push(card);
                        console.log(card.rank + ' ' + card.suit);
                        decks[deckNumber] = toDraw;
                    } else if (toDraw.card.length === 0) {
                        console.log('You drawed all the card, shaffle and draw ' + (cardsNumber - i) + ' cards ');
                        break;
                    } else {
                        console.log('ERROR 01');
                        break;
                    }
                }
            } else {
                console.log('You drawed all the card, shaffle and draw ' + (cardsNumber) + ' cards ');
            }

        }
        var graveyard = function(deckNumber) {
            //todo control parameter: if they are number and if they are <=8
            var toDraw = decks[deckNumber];

            if (toDraw.graveyard.length > 0) {
                for (var i = 0; i < toDraw.graveyard.length; i++) {
                    card = toDraw.graveyard[(i)];
                    console.log(card.rank + ' ' + card.suit);
                }
            }

        }
        var shaffle = function(deckNumber) {
            //todo control parameter: if they are number and if they are <=8

            var ordered = [];
            //for each type of suit
            for (var i = 0; i < suits.length; i++) {
                //and for each rank
                for (var j = 0; j < ranks.length; j++) {
                    //make a card
                    var card = {};
                    card.suit = suits[i];
                    card.rank = ranks[j];
                    ordered.push(card);
                }
            }

            if (ordered.length > 0) {
                for (var x = 0; x < 52; x++) {
                    var randIndex = Math.floor(Math.random() * ordered.length);
                    var cards = ordered.splice(randIndex, 1);
                    decks[deckNumber].card.push(cards[0]);
                }
            }

        }
        var init = function() {
            decks = [];
            for (var z = 0; z < 8; z++) {
                decks.push({
                    card: [],
                    hand: [],
                    graveyard: [],
					player: ''
                })
                shaffle(z);
            }
        }
    </script>


</body>

</html>